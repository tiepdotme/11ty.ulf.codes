---
layout: image
notags: true
nodate: true
nostepnav: true
---
<style>
    .gallery {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        grid-template-rows: repeat(auto-fit, minmax(150px, 1fr));
        grid-column-gap: var(--space-3);
        align-items: flex-start;
    }

    .gallery img {
        vertical-align: bottom;
        margin: 0 auto;
    }

    @media (max-width: 400px) {
        .gallery {
            display: block;
        }
    }
</style>
{{ content }}
<div class="breakout">
    <div id="image-container" class="gallery"></div>
    <button id="load-more" class="block mrx-auto width-5">Load more images</button>
</div>

{%- assign liveContent = collections.livePosts | mustContainTag: tags | reverse %}
{%- assign imageData = collections.livePosts | mustContainTag: tags | reverse | firstImage -%}

<script>
    var imageData = {{ imageData | jsonify }};
    var index = getIndex();
    var increment = 10;
    var container = document.getElementById('image-container');

    function appendImage(imgData) {
        let figure = document.createElement('figure');
        container.appendChild(figure);
        let anchor = document.createElement('a');
        anchor.classList = 'no-deco';
        anchor.href = imgData.url;
        figure.appendChild(anchor);

        let img = document.createElement('img');
        img.src = imgData.src;
        img.alt = imgData.alt;
        img.classList = 'fit-cover width-100'
        img.setAttribute('loading', 'lazy');

        anchor.appendChild(img);

        if (imgData.title) {
            let figCaption = document.createElement('figcaption');
            figCaption.innerText = imgData.title;
            figCaption.classList = 'meta small';
            figure.appendChild(figCaption);
        }
    }

    function getIndex() {
        let queryString = location.search;
        let params = new URLSearchParams(queryString);
        let index = parseInt(params.get("index"));
        return index
            ? index
            : 0;
    }

    function loadImages({start, end}) {
        start = start
            ? start
            : 0;
        end = end
            ? end + increment
            : start + increment;

        for (let i = start; i < end && i < imageData.length; i++) {
            appendImage(imageData[i]);
        }
    }

    loadImages({start: 0, end: getIndex()});

    let loadMore = document.getElementById('load-more');
    if (index + increment > imageData.length) {
        loadMore.style = 'display:none;';
    }
    loadMore.addEventListener('click', event => {
        index += increment;
        history.replaceState(null, '', location.pathname + '?index=' + index);
        loadImages({start: index});
        if (index + increment > imageData.length) {
            loadMore.style = 'display:none;';
        }
    });
</script>